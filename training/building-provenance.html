<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 7 Building provenance | NCEAS Data Team Training</title>
  <meta name="description" content="This is a training guide and reference resource for NCEAS data team members working on the SASAP and Arctic Data Center projects" />
  <meta name="generator" content="bookdown 0.26.3 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 7 Building provenance | NCEAS Data Team Training" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This is a training guide and reference resource for NCEAS data team members working on the SASAP and Arctic Data Center projects" />
  <meta name="github-repo" content="NCEAS/datateam-training" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 7 Building provenance | NCEAS Data Team Training" />
  
  <meta name="twitter:description" content="This is a training guide and reference resource for NCEAS data team members working on the SASAP and Arctic Data Center projects" />
  

<meta name="author" content="Jesse Goldstein, Dominic Mullen, Jeanette Clark, Irene Steves, Mitchell Maier, Bryce Mecum, Peter Slaughter, Emily O’Dean, Jasmine Lai, Daphne Virlar-Knight" />


<meta name="date" content="2022-06-07" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
<link rel="prev" href="editing-system-metadata.html"/>
<link rel="next" href="using-git.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="../styles.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Data Team Training</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome to NCEAS!</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#first-day-to-dos"><i class="fa fa-check"></i>First day to-dos</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#account-information"><i class="fa fa-check"></i>Account information</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#nceas-events"><i class="fa fa-check"></i>NCEAS events</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#nceas-community-meetings-groups"><i class="fa fa-check"></i>NCEAS Community Meetings/ Groups</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#internship-expectations"><i class="fa fa-check"></i>Internship Expectations</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#code-of-conduct"><i class="fa fa-check"></i>Code of Conduct</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#citation-information"><i class="fa fa-check"></i>Citation Information</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="introduction-to-open-science.html"><a href="introduction-to-open-science.html"><i class="fa fa-check"></i><b>1</b> Introduction to open science</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction-to-open-science.html"><a href="introduction-to-open-science.html#background-reading"><i class="fa fa-check"></i><b>1.1</b> Background reading</a></li>
<li class="chapter" data-level="1.2" data-path="introduction-to-open-science.html"><a href="introduction-to-open-science.html#effective-data-management"><i class="fa fa-check"></i><b>1.2</b> Effective data management</a></li>
<li class="chapter" data-level="1.3" data-path="introduction-to-open-science.html"><a href="introduction-to-open-science.html#using-dataone"><i class="fa fa-check"></i><b>1.3</b> Using DataONE</a></li>
<li class="chapter" data-level="1.4" data-path="introduction-to-open-science.html"><a href="introduction-to-open-science.html#working-on-a-remote-server"><i class="fa fa-check"></i><b>1.4</b> Working on a remote server</a></li>
<li class="chapter" data-level="1.5" data-path="introduction-to-open-science.html"><a href="introduction-to-open-science.html#a-note-on-paths"><i class="fa fa-check"></i><b>1.5</b> A note on paths</a></li>
<li class="chapter" data-level="1.6" data-path="introduction-to-open-science.html"><a href="introduction-to-open-science.html#a-note-on-r"><i class="fa fa-check"></i><b>1.6</b> A note on R</a></li>
<li class="chapter" data-level="1.7" data-path="introduction-to-open-science.html"><a href="introduction-to-open-science.html#a-note-on-effective-troubleshooting-in-r"><i class="fa fa-check"></i><b>1.7</b> A note on effective troubleshooting in R</a></li>
<li class="chapter" data-level="1.8" data-path="introduction-to-open-science.html"><a href="introduction-to-open-science.html#a-note-on-exercises"><i class="fa fa-check"></i><b>1.8</b> A note on Exercises</a></li>
<li class="chapter" data-level="1.9" data-path="introduction-to-open-science.html"><a href="introduction-to-open-science.html#exercise-1"><i class="fa fa-check"></i><b>1.9</b> Exercise 1</a>
<ul>
<li class="chapter" data-level="1.9.1" data-path="introduction-to-open-science.html"><a href="introduction-to-open-science.html#part-1"><i class="fa fa-check"></i><b>1.9.1</b> Part 1</a></li>
<li class="chapter" data-level="1.9.2" data-path="introduction-to-open-science.html"><a href="introduction-to-open-science.html#part-2"><i class="fa fa-check"></i><b>1.9.2</b> Part 2</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="creating-a-data-package.html"><a href="creating-a-data-package.html"><i class="fa fa-check"></i><b>2</b> Creating a data package</a>
<ul>
<li class="chapter" data-level="2.1" data-path="creating-a-data-package.html"><a href="creating-a-data-package.html#what-is-in-a-package"><i class="fa fa-check"></i><b>2.1</b> What is in a package?</a></li>
<li class="chapter" data-level="2.2" data-path="creating-a-data-package.html"><a href="creating-a-data-package.html#packages-on-the-website"><i class="fa fa-check"></i><b>2.2</b> Packages on the Website</a></li>
<li class="chapter" data-level="2.3" data-path="creating-a-data-package.html"><a href="creating-a-data-package.html#about-identifiers"><i class="fa fa-check"></i><b>2.3</b> About identifiers</a></li>
<li class="chapter" data-level="2.4" data-path="creating-a-data-package.html"><a href="creating-a-data-package.html#upload-a-package"><i class="fa fa-check"></i><b>2.4</b> Upload a package</a></li>
<li class="chapter" data-level="2.5" data-path="creating-a-data-package.html"><a href="creating-a-data-package.html#datapack-background"><i class="fa fa-check"></i><b>2.5</b> datapack Background</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="creating-a-data-package.html"><a href="creating-a-data-package.html#navigating-data-packages"><i class="fa fa-check"></i><b>2.5.1</b> Navigating data packages</a></li>
<li class="chapter" data-level="2.5.2" data-path="creating-a-data-package.html"><a href="creating-a-data-package.html#data-objects"><i class="fa fa-check"></i><b>2.5.2</b> Data Objects</a></li>
<li class="chapter" data-level="2.5.3" data-path="creating-a-data-package.html"><a href="creating-a-data-package.html#provenance"><i class="fa fa-check"></i><b>2.5.3</b> Provenance</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="creating-a-data-package.html"><a href="creating-a-data-package.html#exercise-2a"><i class="fa fa-check"></i><b>2.6</b> Exercise 2a</a></li>
<li class="chapter" data-level="2.7" data-path="creating-a-data-package.html"><a href="creating-a-data-package.html#create-a-new-data-package"><i class="fa fa-check"></i><b>2.7</b> Create a new data package</a>
<ul>
<li class="chapter" data-level="2.7.1" data-path="creating-a-data-package.html"><a href="creating-a-data-package.html#upload-new-data-files"><i class="fa fa-check"></i><b>2.7.1</b> Upload new data files</a></li>
<li class="chapter" data-level="2.7.2" data-path="creating-a-data-package.html"><a href="creating-a-data-package.html#upload-the-package"><i class="fa fa-check"></i><b>2.7.2</b> Upload the package</a></li>
</ul></li>
<li class="chapter" data-level="2.8" data-path="creating-a-data-package.html"><a href="creating-a-data-package.html#exercise-2b"><i class="fa fa-check"></i><b>2.8</b> Exercise 2b</a>
<ul>
<li class="chapter" data-level="2.8.1" data-path="creating-a-data-package.html"><a href="creating-a-data-package.html#part-1---gather-your-data-files"><i class="fa fa-check"></i><b>2.8.1</b> Part 1 - Gather your data files</a></li>
<li class="chapter" data-level="2.8.2" data-path="creating-a-data-package.html"><a href="creating-a-data-package.html#part-2---working-in-r"><i class="fa fa-check"></i><b>2.8.2</b> Part 2 - Working in R</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="exploring-eml.html"><a href="exploring-eml.html"><i class="fa fa-check"></i><b>3</b> Exploring EML</a>
<ul>
<li class="chapter" data-level="3.1" data-path="exploring-eml.html"><a href="exploring-eml.html#navigate-through-eml"><i class="fa fa-check"></i><b>3.1</b> Navigate through EML</a></li>
<li class="chapter" data-level="3.2" data-path="exploring-eml.html"><a href="exploring-eml.html#understand-the-eml-schema"><i class="fa fa-check"></i><b>3.2</b> Understand the EML schema</a></li>
<li class="chapter" data-level="3.3" data-path="exploring-eml.html"><a href="exploring-eml.html#access-specific-elements"><i class="fa fa-check"></i><b>3.3</b> Access specific elements</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="editing-eml.html"><a href="editing-eml.html"><i class="fa fa-check"></i><b>4</b> Editing EML</a>
<ul>
<li class="chapter" data-level="4.1" data-path="editing-eml.html"><a href="editing-eml.html#edit-an-eml-element"><i class="fa fa-check"></i><b>4.1</b> Edit an EML element</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="editing-eml.html"><a href="editing-eml.html#edit-eml-with-strings"><i class="fa fa-check"></i><b>4.1.1</b> Edit EML with strings</a></li>
<li class="chapter" data-level="4.1.2" data-path="editing-eml.html"><a href="editing-eml.html#edit-eml-with-the-eml-package"><i class="fa fa-check"></i><b>4.1.2</b> Edit EML with the “EML” package</a></li>
<li class="chapter" data-level="4.1.3" data-path="editing-eml.html"><a href="editing-eml.html#edit-eml-with-objects"><i class="fa fa-check"></i><b>4.1.3</b> Edit EML with objects</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="editing-eml.html"><a href="editing-eml.html#fair-data-practices"><i class="fa fa-check"></i><b>4.2</b> FAIR data practices</a></li>
<li class="chapter" data-level="4.3" data-path="editing-eml.html"><a href="editing-eml.html#edit-attributelists"><i class="fa fa-check"></i><b>4.3</b> Edit attributeLists</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="editing-eml.html"><a href="editing-eml.html#edit-attributes"><i class="fa fa-check"></i><b>4.3.1</b> Edit attributes</a></li>
<li class="chapter" data-level="4.3.2" data-path="editing-eml.html"><a href="editing-eml.html#edit-custom-units"><i class="fa fa-check"></i><b>4.3.2</b> Edit custom units</a></li>
<li class="chapter" data-level="4.3.3" data-path="editing-eml.html"><a href="editing-eml.html#edit-factors"><i class="fa fa-check"></i><b>4.3.3</b> Edit factors</a></li>
<li class="chapter" data-level="4.3.4" data-path="editing-eml.html"><a href="editing-eml.html#finalize-attributelist"><i class="fa fa-check"></i><b>4.3.4</b> Finalize attributeList</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="editing-eml.html"><a href="editing-eml.html#set-physical"><i class="fa fa-check"></i><b>4.4</b> Set physical</a></li>
<li class="chapter" data-level="4.5" data-path="editing-eml.html"><a href="editing-eml.html#edit-datatables"><i class="fa fa-check"></i><b>4.5</b> Edit dataTables</a></li>
<li class="chapter" data-level="4.6" data-path="editing-eml.html"><a href="editing-eml.html#edit-otherentities"><i class="fa fa-check"></i><b>4.6</b> Edit otherEntities</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="editing-eml.html"><a href="editing-eml.html#remove-otherentities"><i class="fa fa-check"></i><b>4.6.1</b> Remove otherEntities</a></li>
<li class="chapter" data-level="4.6.2" data-path="editing-eml.html"><a href="editing-eml.html#create-otherentities"><i class="fa fa-check"></i><b>4.6.2</b> Create otherEntities</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="editing-eml.html"><a href="editing-eml.html#semantic-annotations"><i class="fa fa-check"></i><b>4.7</b> Semantic annotations</a>
<ul>
<li class="chapter" data-level="4.7.1" data-path="editing-eml.html"><a href="editing-eml.html#how-annotations-are-used"><i class="fa fa-check"></i><b>4.7.1</b> How annotations are used</a></li>
<li class="chapter" data-level="4.7.2" data-path="editing-eml.html"><a href="editing-eml.html#how-to-add-an-annotation"><i class="fa fa-check"></i><b>4.7.2</b> How to add an annotation</a></li>
<li class="chapter" data-level="4.7.3" data-path="editing-eml.html"><a href="editing-eml.html#annotating-sensitive-data"><i class="fa fa-check"></i><b>4.7.3</b> Annotating sensitive data</a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="editing-eml.html"><a href="editing-eml.html#exercise-3a"><i class="fa fa-check"></i><b>4.8</b> Exercise 3a</a></li>
<li class="chapter" data-level="4.9" data-path="editing-eml.html"><a href="editing-eml.html#validate-eml-and-update-package"><i class="fa fa-check"></i><b>4.9</b> Validate EML and update package</a></li>
<li class="chapter" data-level="4.10" data-path="editing-eml.html"><a href="editing-eml.html#exercise-3b"><i class="fa fa-check"></i><b>4.10</b> Exercise 3b</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="updating-a-data-package.html"><a href="updating-a-data-package.html"><i class="fa fa-check"></i><b>5</b> Updating a data package</a>
<ul>
<li class="chapter" data-level="5.1" data-path="updating-a-data-package.html"><a href="updating-a-data-package.html#update-a-data-object"><i class="fa fa-check"></i><b>5.1</b> Update a data object</a></li>
<li class="chapter" data-level="5.2" data-path="updating-a-data-package.html"><a href="updating-a-data-package.html#update-a-package-with-a-new-data-object"><i class="fa fa-check"></i><b>5.2</b> Update a package with a new data object</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="updating-a-data-package.html"><a href="updating-a-data-package.html#publish-update"><i class="fa fa-check"></i><b>5.2.1</b> Publish update</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="updating-a-data-package.html"><a href="updating-a-data-package.html#exercise-4"><i class="fa fa-check"></i><b>5.3</b> Exercise 4</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="editing-system-metadata.html"><a href="editing-system-metadata.html"><i class="fa fa-check"></i><b>6</b> Editing system metadata</a>
<ul>
<li class="chapter" data-level="6.1" data-path="editing-system-metadata.html"><a href="editing-system-metadata.html#edit-sysmeta"><i class="fa fa-check"></i><b>6.1</b> Edit sysmeta</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="editing-system-metadata.html"><a href="editing-system-metadata.html#identifiers-and-sysmeta"><i class="fa fa-check"></i><b>6.1.1</b> Identifiers and sysmeta</a></li>
<li class="chapter" data-level="6.1.2" data-path="editing-system-metadata.html"><a href="editing-system-metadata.html#additional-resources"><i class="fa fa-check"></i><b>6.1.2</b> Additional resources</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="editing-system-metadata.html"><a href="editing-system-metadata.html#exercise-5"><i class="fa fa-check"></i><b>6.2</b> Exercise 5</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="building-provenance.html"><a href="building-provenance.html"><i class="fa fa-check"></i><b>7</b> Building provenance</a>
<ul>
<li class="chapter" data-level="7.1" data-path="building-provenance.html"><a href="building-provenance.html#using-the-prov-editor"><i class="fa fa-check"></i><b>7.1</b> Using the prov editor</a></li>
<li class="chapter" data-level="7.2" data-path="building-provenance.html"><a href="building-provenance.html#understanding-resource-maps"><i class="fa fa-check"></i><b>7.2</b> Understanding resource maps</a></li>
<li class="chapter" data-level="7.3" data-path="building-provenance.html"><a href="building-provenance.html#using-the-datapack-package"><i class="fa fa-check"></i><b>7.3</b> Using the <code>datapack</code> package</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="building-provenance.html"><a href="building-provenance.html#fixing-mistakes"><i class="fa fa-check"></i><b>7.3.1</b> Fixing mistakes</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="building-provenance.html"><a href="building-provenance.html#references"><i class="fa fa-check"></i><b>7.4</b> References</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="using-git.html"><a href="using-git.html"><i class="fa fa-check"></i><b>8</b> Using Git</a>
<ul>
<li class="chapter" data-level="8.1" data-path="using-git.html"><a href="using-git.html#usage-in-the-datateam"><i class="fa fa-check"></i><b>8.1</b> Usage in the datateam</a></li>
<li class="chapter" data-level="8.2" data-path="using-git.html"><a href="using-git.html#what-is-git"><i class="fa fa-check"></i><b>8.2</b> What is Git?</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="using-git.html"><a href="using-git.html#so-why-do-i-need-to-use-this-again"><i class="fa fa-check"></i><b>8.2.1</b> So why do I need to use this again?</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="using-git.html"><a href="using-git.html#setting-up-git"><i class="fa fa-check"></i><b>8.3</b> Setting up Git</a></li>
<li class="chapter" data-level="8.4" data-path="using-git.html"><a href="using-git.html#github-authentication"><i class="fa fa-check"></i><b>8.4</b> GitHub Authentication</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="using-git.html"><a href="using-git.html#cloning-the-arctic-data-repo"><i class="fa fa-check"></i><b>8.4.1</b> Cloning the arctic-data repo</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="using-git.html"><a href="using-git.html#working-with-the-repository"><i class="fa fa-check"></i><b>8.5</b> Working with the repository</a>
<ul>
<li class="chapter" data-level="8.5.1" data-path="using-git.html"><a href="using-git.html#adding-a-new-script"><i class="fa fa-check"></i><b>8.5.1</b> Adding a new script</a></li>
<li class="chapter" data-level="8.5.2" data-path="using-git.html"><a href="using-git.html#editing-a-script"><i class="fa fa-check"></i><b>8.5.2</b> Editing a script</a></li>
<li class="chapter" data-level="8.5.3" data-path="using-git.html"><a href="using-git.html#where-do-i-commit"><i class="fa fa-check"></i><b>8.5.3</b> Where do I commit?</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="using-git.html"><a href="using-git.html#my-git-tab-disappeared"><i class="fa fa-check"></i><b>8.6</b> My Git tab disappeared</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="first-ticket.html"><a href="first-ticket.html"><i class="fa fa-check"></i><b>9</b> First Ticket</a>
<ul>
<li class="chapter" data-level="9.1" data-path="first-ticket.html"><a href="first-ticket.html#navigate-rt"><i class="fa fa-check"></i><b>9.1</b> Navigate RT</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="first-ticket.html"><a href="first-ticket.html#front-page"><i class="fa fa-check"></i><b>9.1.1</b> Front page</a></li>
<li class="chapter" data-level="9.1.2" data-path="first-ticket.html"><a href="first-ticket.html#all-tickets"><i class="fa fa-check"></i><b>9.1.2</b> All tickets</a></li>
<li class="chapter" data-level="9.1.3" data-path="first-ticket.html"><a href="first-ticket.html#example-ticket"><i class="fa fa-check"></i><b>9.1.3</b> Example ticket</a></li>
<li class="chapter" data-level="9.1.4" data-path="first-ticket.html"><a href="first-ticket.html#new-data-submission"><i class="fa fa-check"></i><b>9.1.4</b> New data submission</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="first-ticket.html"><a href="first-ticket.html#initial-review-checklist"><i class="fa fa-check"></i><b>9.2</b> Initial review checklist</a></li>
<li class="chapter" data-level="9.3" data-path="first-ticket.html"><a href="first-ticket.html#processing-templates"><i class="fa fa-check"></i><b>9.3</b> Processing templates</a></li>
<li class="chapter" data-level="9.4" data-path="first-ticket.html"><a href="first-ticket.html#final-checklist"><i class="fa fa-check"></i><b>9.4</b> Final Checklist</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="first-ticket.html"><a href="first-ticket.html#special-datasets"><i class="fa fa-check"></i><b>9.4.1</b> Special Datasets</a></li>
<li class="chapter" data-level="9.4.2" data-path="first-ticket.html"><a href="first-ticket.html#system-metadata"><i class="fa fa-check"></i><b>9.4.2</b> System Metadata</a></li>
<li class="chapter" data-level="9.4.3" data-path="first-ticket.html"><a href="first-ticket.html#general-eml"><i class="fa fa-check"></i><b>9.4.3</b> General EML</a></li>
<li class="chapter" data-level="9.4.4" data-path="first-ticket.html"><a href="first-ticket.html#title-1"><i class="fa fa-check"></i><b>9.4.4</b> Title</a></li>
<li class="chapter" data-level="9.4.5" data-path="first-ticket.html"><a href="first-ticket.html#abstract-1"><i class="fa fa-check"></i><b>9.4.5</b> Abstract</a></li>
<li class="chapter" data-level="9.4.6" data-path="first-ticket.html"><a href="first-ticket.html#datatable-otherentity-spatialvectors"><i class="fa fa-check"></i><b>9.4.6</b> DataTable / OtherEntity / SpatialVectors</a></li>
<li class="chapter" data-level="9.4.7" data-path="first-ticket.html"><a href="first-ticket.html#people"><i class="fa fa-check"></i><b>9.4.7</b> People</a></li>
<li class="chapter" data-level="9.4.8" data-path="first-ticket.html"><a href="first-ticket.html#geographic-region"><i class="fa fa-check"></i><b>9.4.8</b> Geographic region</a></li>
<li class="chapter" data-level="9.4.9" data-path="first-ticket.html"><a href="first-ticket.html#project"><i class="fa fa-check"></i><b>9.4.9</b> Project</a></li>
<li class="chapter" data-level="9.4.10" data-path="first-ticket.html"><a href="first-ticket.html#methods-1"><i class="fa fa-check"></i><b>9.4.10</b> Methods</a></li>
<li class="chapter" data-level="9.4.11" data-path="first-ticket.html"><a href="first-ticket.html#check-eml-version"><i class="fa fa-check"></i><b>9.4.11</b> Check EML Version</a></li>
<li class="chapter" data-level="9.4.12" data-path="first-ticket.html"><a href="first-ticket.html#access"><i class="fa fa-check"></i><b>9.4.12</b> Access</a></li>
<li class="chapter" data-level="9.4.13" data-path="first-ticket.html"><a href="first-ticket.html#sftp-files"><i class="fa fa-check"></i><b>9.4.13</b> SFTP Files</a></li>
<li class="chapter" data-level="9.4.14" data-path="first-ticket.html"><a href="first-ticket.html#updated-datasets"><i class="fa fa-check"></i><b>9.4.14</b> Updated datasets</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="first-ticket.html"><a href="first-ticket.html#email-templates"><i class="fa fa-check"></i><b>9.5</b> Email templates</a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="first-ticket.html"><a href="first-ticket.html#initial-email-template"><i class="fa fa-check"></i><b>9.5.1</b> Initial email template</a></li>
<li class="chapter" data-level="9.5.2" data-path="first-ticket.html"><a href="first-ticket.html#comment-templates-based-on-what-is-missing"><i class="fa fa-check"></i><b>9.5.2</b> Comment templates based on what is missing</a></li>
<li class="chapter" data-level="9.5.3" data-path="first-ticket.html"><a href="first-ticket.html#final-email-templates"><i class="fa fa-check"></i><b>9.5.3</b> Final email templates</a></li>
<li class="chapter" data-level="9.5.4" data-path="first-ticket.html"><a href="first-ticket.html#additional-email-templates"><i class="fa fa-check"></i><b>9.5.4</b> Additional email templates</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="first-ticket.html"><a href="first-ticket.html#categorize-datasets"><i class="fa fa-check"></i><b>9.6</b> Categorize datasets</a></li>
<li class="chapter" data-level="9.7" data-path="first-ticket.html"><a href="first-ticket.html#congrats"><i class="fa fa-check"></i><b>9.7</b> Congrats!</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="beyond-your-first-ticket.html"><a href="beyond-your-first-ticket.html"><i class="fa fa-check"></i><b>10</b> Beyond your first ticket</a>
<ul>
<li class="chapter" data-level="10.1" data-path="beyond-your-first-ticket.html"><a href="beyond-your-first-ticket.html#working-with-large-data-packages"><i class="fa fa-check"></i><b>10.1</b> Working with large data packages</a></li>
<li class="chapter" data-level="10.2" data-path="beyond-your-first-ticket.html"><a href="beyond-your-first-ticket.html#add-physicals-to-submissions"><i class="fa fa-check"></i><b>10.2</b> Add physicals to submissions</a></li>
<li class="chapter" data-level="10.3" data-path="beyond-your-first-ticket.html"><a href="beyond-your-first-ticket.html#use-references"><i class="fa fa-check"></i><b>10.3</b> Use references</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="beyond-your-first-ticket.html"><a href="beyond-your-first-ticket.html#example-with-parties"><i class="fa fa-check"></i><b>10.3.1</b> Example with parties</a></li>
<li class="chapter" data-level="10.3.2" data-path="beyond-your-first-ticket.html"><a href="beyond-your-first-ticket.html#example-with-attributes"><i class="fa fa-check"></i><b>10.3.2</b> Example with attributes</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="beyond-your-first-ticket.html"><a href="beyond-your-first-ticket.html#annotations"><i class="fa fa-check"></i><b>10.4</b> Annotations</a></li>
<li class="chapter" data-level="10.5" data-path="beyond-your-first-ticket.html"><a href="beyond-your-first-ticket.html#streamlining-your-workflow"><i class="fa fa-check"></i><b>10.5</b> Streamlining your workflow</a></li>
<li class="chapter" data-level="10.6" data-path="beyond-your-first-ticket.html"><a href="beyond-your-first-ticket.html#code-snippets"><i class="fa fa-check"></i><b>10.6</b> Code Snippets</a></li>
<li class="chapter" data-level="10.7" data-path="beyond-your-first-ticket.html"><a href="beyond-your-first-ticket.html#resources-for-r"><i class="fa fa-check"></i><b>10.7</b> Resources for R</a>
<ul>
<li class="chapter" data-level="10.7.1" data-path="beyond-your-first-ticket.html"><a href="beyond-your-first-ticket.html#learning"><i class="fa fa-check"></i><b>10.7.1</b> Learning</a></li>
<li class="chapter" data-level="10.7.2" data-path="beyond-your-first-ticket.html"><a href="beyond-your-first-ticket.html#packages"><i class="fa fa-check"></i><b>10.7.2</b> Packages</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://nceas.github.io/datateam-training/reference" target="blank">Reference Guide</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">NCEAS Data Team Training</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="building-provenance" class="section level1 hasAnchor" number="7">
<h1><span class="header-section-number">Chapter 7</span> Building provenance<a href="building-provenance.html#building-provenance" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p><strong>Note</strong> - It is rare for a dataset to have provenance - though we would like to see that change by encouraging researchers to submit scripts whenever it is reasonable. When processing datasets if you notice that provenance is needed let Daphne or Jeanette know.</p>
<p>The provenance chain describes the origin and processing history of data. Provenance (or “prov”) can exist on a continuum, ranging from prose descriptions of the history, to formal provenance traces, to fully executable environments. In this section we will describe how to build provenance using formal provenance traces in DataONE.</p>
<p>Provenance is becoming increasingly important in the face of what is being called a reproducibility crisis in science. J. P. A. Ioannidis (2005) wrote that “Most Research Findings Are False for Most Research Designs and for Most Fields”. Ioannidis outlined ways in which the research process has lead to inflated effect sizes and hypothesis tests that codify existing biases.</p>
<p>The first step towards addressing these issues is to be able to evaluate the data, analyses, and models on which conclusions are drawn. Under current practice, this can be difficult because data are typically unavailable, the method sections of papers do not detail the computational approaches used, and analyses and models are often conducted in graphical programs, or, when scripted analyses are employed, the code is not available.</p>
<p>And yet, this is easily remedied. Researchers can achieve computational reproducibility through open science approaches, including straightforward steps for archiving data and code openly along with the scientific workflows describing the provenance of scientific results (e.g., Hampton et al. (2015), Munafò et al. (2017)).</p>
<p>At NCEAS and in the datateam, not only do we archive data and code openly, but we also describe the workflows that involve that data and code using provenance, formalizing the provenance trace for a workflow that might look like this <img src="images/workflow.png" /> into an easily understandable trace including archived data objects, such as what is shown <a href = 'https://goa.nceas.ucsb.edu/#view/urn:uuid:3249ada0-afe3-4dd6-875e-0f7928a4c171' target='_blank'>here</a>.</p>
<p>There are two ways that we add provenance in the datateam - the prov editor and the R <code>datapack</code> package.</p>
<div id="using-the-prov-editor" class="section level2 hasAnchor" number="7.1">
<h2><span class="header-section-number">7.1</span> Using the prov editor<a href="building-provenance.html#using-the-prov-editor" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Provenance can easily be added to production Arctic Data Center packages using the provenance editor on the Arctic Data Center. On the landing page of a data package within beta, in the <code>dataTable</code> or <code>otherEntity</code> section where you would like to add a provenance relationship, you can choose to add either a “source” or a “derivation”, to the left or right of the object pane, respectively.</p>
<p><img src="images/add_prov.png" /></p>
<p>To add a source data file, click on the circle with the “+ add” text. Similarly, a source script would be added by selecting the arrow. Selecting the circle to add a source file pulls up the following screen, where you can select the source from other data objects within the same data package. <img src="images/add_source.png" /></p>
<p>A data package with an object that has multiple sources added will look like this. <img src="images/prov_sources.png" /></p>
<p>For simple packages on the Arctic Data Center, adding prov through the prov editor is super easy!</p>
</div>
<div id="understanding-resource-maps" class="section level2 hasAnchor" number="7.2">
<h2><span class="header-section-number">7.2</span> Understanding resource maps<a href="building-provenance.html#understanding-resource-maps" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Before we dive further into constructing prov in R, we need to talk more about resource maps (or “resmaps”).</p>
<p>All data packages have a single resource map. But what is a resource map and how do we use one to find out what objects are in a particular data package? This document is a short introduction but a more complete guide can be found <a href = 'https://releases.dataone.org/online/api-documentation-v2.0/design/DataPackage.html?highlight=resource%20map' target='_blank'>here</a>.</p>
<p>A resource map is a special kind of XML document that describes (among other things) an “aggregation”. The aggregation describes the members of a data package (metadata and data, usually). We can use the <code>dataone</code> R package to download a resource map if we know its <code>PID</code>:</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="building-provenance.html#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dataone)</span>
<span id="cb95-2"><a href="building-provenance.html#cb95-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-3"><a href="building-provenance.html#cb95-3" aria-hidden="true" tabindex="-1"></a>d1c_test <span class="ot">&lt;-</span> dataone<span class="sc">::</span><span class="fu">D1Client</span>(<span class="st">&quot;STAGING&quot;</span>, <span class="st">&quot;urn:node:mnTestARCTIC&quot;</span>)</span>
<span id="cb95-4"><a href="building-provenance.html#cb95-4" aria-hidden="true" tabindex="-1"></a>pid <span class="ot">&lt;-</span> <span class="st">&quot;urn:uuid:82bd7d7f-9e18-4fd2-8bda-99b1fddab556&quot;</span> <span class="co"># A resource map PID</span></span>
<span id="cb95-5"><a href="building-provenance.html#cb95-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-6"><a href="building-provenance.html#cb95-6" aria-hidden="true" tabindex="-1"></a>path <span class="ot">&lt;-</span> <span class="fu">tempfile</span>(<span class="at">fileext =</span> <span class="st">&quot;.xml&quot;</span>) <span class="co"># We&#39;re saving to a temporary file but you can save elsewhere</span></span>
<span id="cb95-7"><a href="building-provenance.html#cb95-7" aria-hidden="true" tabindex="-1"></a><span class="fu">writeLines</span>(<span class="fu">rawToChar</span>(<span class="fu">getObject</span>(d1c_test<span class="sc">@</span>mn, pid)), path) <span class="co"># Write the object to `path`</span></span></code></pre></div>
<p>If we open that file up in a text editor, we see this:</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;rdf:RDF xmlns:cito=&quot;http://purl.org/spar/cito/&quot; xmlns:dc=&quot;http://purl.org/dc/elements/1.1/&quot; xmlns:dcterms=&quot;http://purl.org/dc/terms/&quot; xmlns:foaf=&quot;http://xmlns.com/foaf/0.1/&quot; xmlns:ore=&quot;http://www.openarchives.org/ore/terms/&quot; xmlns:prov=&quot;http://www.w3.org/ns/prov#&quot; xmlns:provone=&quot;http://purl.dataone.org/provone/2015/01/15/ontology#&quot; xmlns:rdf=&quot;http://www.w3.org/1999/02/22-rdf-syntax-ns#&quot; xmlns:rdfs=&quot;http://www.w3.org/2000/01/rdf-schema#&quot; xmlns:xsd=&quot;http://www.w3.org/2001/XMLSchema#&quot;&gt;
  &lt;rdf:Description rdf:about=&quot;https://cn.dataone.org/cn/v2/resolve/urn%3Auuid%3A61b48e72-ea29-4ba5-8131-4f59a9ebcd27&quot;&gt;
    &lt;cito:isDocumentedBy rdf:resource=&quot;https://cn.dataone.org/cn/v2/resolve/urn%3Auuid%3Ac59b7505-39e6-4def-bc82-b67a8d117ce5&quot;/&gt;
  &lt;/rdf:Description&gt;
  &lt;rdf:Description rdf:about=&quot;https://cn.dataone.org/cn/v2/resolve/urn%3Auuid%3A82bd7d7f-9e18-4fd2-8bda-99b1fddab556#aggregation&quot;&gt;
    &lt;rdf:type rdf:resource=&quot;http://www.openarchives.org/ore/terms/Aggregation&quot;/&gt;
  &lt;/rdf:Description&gt;
  &lt;rdf:Description rdf:about=&quot;https://cn.dataone.org/cn/v2/resolve/urn%3Auuid%3Ac59b7505-39e6-4def-bc82-b67a8d117ce5&quot;&gt;
    &lt;cito:isDocumentedBy rdf:resource=&quot;https://cn.dataone.org/cn/v2/resolve/urn%3Auuid%3Ac59b7505-39e6-4def-bc82-b67a8d117ce5&quot;/&gt;
  &lt;/rdf:Description&gt;
  &lt;rdf:Description rdf:about=&quot;https://cn.dataone.org/cn/v2/resolve/urn%3Auuid%3Ac59b7505-39e6-4def-bc82-b67a8d117ce5&quot;&gt;
    &lt;cito:documents rdf:resource=&quot;https://cn.dataone.org/cn/v2/resolve/urn%3Auuid%3A61b48e72-ea29-4ba5-8131-4f59a9ebcd27&quot;/&gt;
  &lt;/rdf:Description&gt;
  &lt;rdf:Description rdf:about=&quot;https://cn.dataone.org/cn/v2/resolve/urn%3Auuid%3Ac59b7505-39e6-4def-bc82-b67a8d117ce5&quot;&gt;
    &lt;cito:documents rdf:resource=&quot;https://cn.dataone.org/cn/v2/resolve/urn%3Auuid%3Ac59b7505-39e6-4def-bc82-b67a8d117ce5&quot;/&gt;
  &lt;/rdf:Description&gt;
  &lt;rdf:Description rdf:about=&quot;https://cn.dataone.org/cn/v2/resolve/urn%3Auuid%3A61b48e72-ea29-4ba5-8131-4f59a9ebcd27&quot;&gt;
    &lt;ore:isAggregatedBy rdf:resource=&quot;https://cn.dataone.org/cn/v2/resolve/urn%3Auuid%3A82bd7d7f-9e18-4fd2-8bda-99b1fddab556#aggregation&quot;/&gt;
  &lt;/rdf:Description&gt;
  &lt;rdf:Description rdf:about=&quot;https://cn.dataone.org/cn/v2/resolve/urn%3Auuid%3A82bd7d7f-9e18-4fd2-8bda-99b1fddab556#aggregation&quot;&gt;
    &lt;dc:title&gt;DataONE Aggregation&lt;/dc:title&gt;
  &lt;/rdf:Description&gt;
  &lt;rdf:Description rdf:about=&quot;https://cn.dataone.org/cn/v2/resolve/urn%3Auuid%3A82bd7d7f-9e18-4fd2-8bda-99b1fddab556&quot;&gt;
    &lt;dcterms:identifier rdf:datatype=&quot;http://www.w3.org/2001/XMLSchema#string&quot;&gt;urn:uuid:82bd7d7f-9e18-4fd2-8bda-99b1fddab556&lt;/dcterms:identifier&gt;
  &lt;/rdf:Description&gt;
  &lt;rdf:Description rdf:about=&quot;https://cn.dataone.org/cn/v2/resolve/urn%3Auuid%3A82bd7d7f-9e18-4fd2-8bda-99b1fddab556&quot;&gt;
    &lt;ore:describes rdf:resource=&quot;https://cn.dataone.org/cn/v2/resolve/urn%3Auuid%3A82bd7d7f-9e18-4fd2-8bda-99b1fddab556#aggregation&quot;/&gt;
  &lt;/rdf:Description&gt;
  &lt;rdf:Description rdf:about=&quot;https://cn.dataone.org/cn/v2/resolve/urn%3Auuid%3Ac59b7505-39e6-4def-bc82-b67a8d117ce5&quot;&gt;
    &lt;ore:isAggregatedBy rdf:resource=&quot;https://cn.dataone.org/cn/v2/resolve/urn%3Auuid%3A82bd7d7f-9e18-4fd2-8bda-99b1fddab556#aggregation&quot;/&gt;
  &lt;/rdf:Description&gt;
  &lt;rdf:Description rdf:about=&quot;https://cn.dataone.org/cn/v2/resolve/urn%3Auuid%3A82bd7d7f-9e18-4fd2-8bda-99b1fddab556#aggregation&quot;&gt;
    &lt;ore:aggregates rdf:resource=&quot;https://cn.dataone.org/cn/v2/resolve/urn%3Auuid%3A61b48e72-ea29-4ba5-8131-4f59a9ebcd27&quot;/&gt;
  &lt;/rdf:Description&gt;
  &lt;rdf:Description rdf:about=&quot;https://cn.dataone.org/cn/v2/resolve/urn%3Auuid%3A82bd7d7f-9e18-4fd2-8bda-99b1fddab556#aggregation&quot;&gt;
    &lt;ore:aggregates rdf:resource=&quot;https://cn.dataone.org/cn/v2/resolve/urn%3Auuid%3Ac59b7505-39e6-4def-bc82-b67a8d117ce5&quot;/&gt;
  &lt;/rdf:Description&gt;
  &lt;rdf:Description rdf:about=&quot;https://cn.dataone.org/cn/v2/resolve/urn%3Auuid%3A82bd7d7f-9e18-4fd2-8bda-99b1fddab556&quot;&gt;
    &lt;rdf:type rdf:resource=&quot;http://www.openarchives.org/ore/terms/ResourceMap&quot;/&gt;
  &lt;/rdf:Description&gt;
  &lt;rdf:Description rdf:about=&quot;https://cn.dataone.org/cn/v2/resolve/urn%3Auuid%3A61b48e72-ea29-4ba5-8131-4f59a9ebcd27&quot;&gt;
    &lt;dcterms:identifier rdf:datatype=&quot;http://www.w3.org/2001/XMLSchema#string&quot;&gt;urn:uuid:61b48e72-ea29-4ba5-8131-4f59a9ebcd27&lt;/dcterms:identifier&gt;
  &lt;/rdf:Description&gt;
  &lt;rdf:Description rdf:about=&quot;https://cn.dataone.org/cn/v2/resolve/urn%3Auuid%3Ac59b7505-39e6-4def-bc82-b67a8d117ce5&quot;&gt;
    &lt;dcterms:identifier rdf:datatype=&quot;http://www.w3.org/2001/XMLSchema#string&quot;&gt;urn:uuid:c59b7505-39e6-4def-bc82-b67a8d117ce5&lt;/dcterms:identifier&gt;
  &lt;/rdf:Description&gt;
&lt;/rdf:RDF&gt;</code></pre>
<p>Whoa! What is this thing and how do you read it to find the members of the data package? The short answer is to look for lines like this:</p>
<pre><code>&lt;rdf:Description rdf:about=&quot;https://cn.dataone.org/cn/v2/resolve/urn%3Auuid%3A82bd7d7f-9e18-4fd2-8bda-99b1fddab556#aggregation&quot;&gt;
    &lt;ore:aggregates rdf:resource=&quot;https://cn.dataone.org/cn/v2/resolve/urn%3Auuid%3Ac59b7505-39e6-4def-bc82-b67a8d117ce5&quot;/&gt;</code></pre>
<p>This line says “The aggregation aggregates <code>urn:uuid:c59b7505-39e6-4def-bc82-b67a8d117ce5</code>” so that means <code>urn:uuid:c59b7505-39e6-4def-bc82-b67a8d117ce5</code> is in our data package! The key bit is the <code>&lt;rdf:Description rdf:about="...#aggregation</code> part. If you look for another similar statement, you’ll also see that <code>urn:uuid:61b48e72-ea29-4ba5-8131-4f59a9ebcd27</code> is part of our data package.</p>
<p>Now we know <em>which</em> objects are in our data package but we don’t know which one contains metadata and which one contains data. For that, we need to get a copy of the system metadata for each object:</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="building-provenance.html#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="fu">getSystemMetadata</span>(d1c_test<span class="sc">@</span>mn, <span class="st">&quot;urn:uuid:c59b7505-39e6-4def-bc82-b67a8d117ce5&quot;</span>)<span class="sc">@</span>formatId</span>
<span id="cb98-2"><a href="building-provenance.html#cb98-2" aria-hidden="true" tabindex="-1"></a><span class="fu">getSystemMetadata</span>(d1c_test<span class="sc">@</span>mn, <span class="st">&quot;urn:uuid:61b48e72-ea29-4ba5-8131-4f59a9ebcd27&quot;</span>)<span class="sc">@</span>formatId</span></code></pre></div>
<p>From the <code>formatId</code>s, we can see the first <code>PID</code> is the EML (<code>formatId</code>: <code>[1]"eml://ecoinformatics.org/eml-2.1.1"</code>) and the second <code>PID</code> is a data object (<code>formatId</code>: <code>[1]"application/octet-stream"</code>). Now we know enough to know what’s in the data package:</p>
<ul>
<li>Resource map: <code>urn:uuid:82bd7d7f-9e18-4fd2-8bda-99b1fddab556</code></li>
<li>Metadata: <code>urn:uuid:c59b7505-39e6-4def-bc82-b67a8d117ce5</code></li>
<li>Data: <code>urn:uuid:61b48e72-ea29-4ba5-8131-4f59a9ebcd27</code></li>
</ul>
<p>Now that you’ve actually seen a resource map, we can dive further into prov.</p>
</div>
<div id="using-the-datapack-package" class="section level2 hasAnchor" number="7.3">
<h2><span class="header-section-number">7.3</span> Using the <code>datapack</code> package<a href="building-provenance.html#using-the-datapack-package" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>For packages not on the ADC, or packages that are extremely complicated, it may be best to upload prov relationships using R. The <code>datapack</code> package has several functions which help add relationships in a very simple way. These relationships are stored in the resource map. When you update a package to only add prov, the package will not be assigned any new identifiers <strong>with the exception of the resource map</strong>.</p>
<p>First, we set the environment, in a similar, but slightly different way than what you may be used to. Here the function <code>D1Client()</code> sets the DataONE client with the coordinating node instance as the first argument, and member node as the second argument.</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="building-provenance.html#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dataone)</span>
<span id="cb99-2"><a href="building-provenance.html#cb99-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(datapack)</span>
<span id="cb99-3"><a href="building-provenance.html#cb99-3" aria-hidden="true" tabindex="-1"></a>d1c <span class="ot">&lt;-</span> <span class="fu">D1Client</span>(<span class="st">&quot;STAGING2&quot;</span>, <span class="st">&quot;urn:node:mnTestKNB&quot;</span>)</span></code></pre></div>
<p>Next, get the <code>PID</code> of the resource map of the data package you are adding prov to, and load that package into R using the <code>getDataPackage()</code> function.</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="building-provenance.html#cb100-1" aria-hidden="true" tabindex="-1"></a>packageId <span class="ot">&lt;-</span> <span class="st">&quot;urn:uuid:8f501606-2c13-4454-b22d-050a4176a97b&quot;</span></span>
<span id="cb100-2"><a href="building-provenance.html#cb100-2" aria-hidden="true" tabindex="-1"></a>dp <span class="ot">&lt;-</span> <span class="fu">getDataPackage</span>(d1c, <span class="at">id=</span>packageId, <span class="at">lazyLoad=</span><span class="cn">TRUE</span>, <span class="at">limit=</span><span class="st">&quot;0MB&quot;</span>, <span class="at">quiet=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<p>Printing <code>pkg</code> in your console shows you the contents of the data package, including all of the objects and their names:</p>
<pre><code>&gt; pkg
Members:

filename   format         mediaType  size     identifier                                    modified local 
esc...er.R application/R  NA         888      knb.92049.1                                   n        n     
PWS....csv text/csv       NA         1871469  knb.92050.1                                   n        n     
PWS....csv text/csv       NA         1508128  knb.92051.1                                   n        n     
NA         eml:/...-2.1.1 NA         15658    urn:uuid:8f501606-2c13-4454-b22d-050a4176a97b n        y     

Package identifier: resource_map_urn:uuid:8f501606-2c13-4454-b22d-050a4176a97b
RightsHolder: http://orcid.org/0000-0002-2192-403X</code></pre>
<p>It will also show the existing relationships in the resource map, which in this case are mostly the “documents” relationships that specify that the metadata record is describing all of these data files.</p>
<pre><code>Relationships:
                                   subject           predicate                                   object
2          esc_reformatting_PWSweirTower.R cito:isDocumentedBy urn:uuid:8f501606-...4-b22d-050a4176a97b
4                        PWS_weirTower.csv cito:isDocumentedBy urn:uuid:8f501606-...4-b22d-050a4176a97b
1                PWS_Weir_Tower_export.csv cito:isDocumentedBy urn:uuid:8f501606-...4-b22d-050a4176a97b
3 urn:uuid:8f501606-...4-b22d-050a4176a97b     dcterms:creator                    _r1515542097r415842r1
5 urn:uuid:8f501606-...4-b22d-050a4176a97b      cito:documents          esc_reformatting_PWSweirTower.R
6 urn:uuid:8f501606-...4-b22d-050a4176a97b      cito:documents                        PWS_weirTower.csv
7 urn:uuid:8f501606-...4-b22d-050a4176a97b      cito:documents                PWS_Weir_Tower_export.csv
8 urn:uuid:8f501606-...4-b22d-050a4176a97b      cito:documents urn:uuid:8f501606-...4-b22d-050a4176a97b
9 urn:uuid:8f501606-...4-b22d-050a4176a97b cito:isDocumentedBy urn:uuid:8f501606-...4-b22d-050a4176a97b</code></pre>
<p>In this example above, the data package has two .csv files, with an R script that converts one to the other. To create our provenance trace, first we need to select the source object, and save the <code>PID</code> to a variable. We do this using the <code>selectMember()</code> function, and we can query part of the system metadata to select the file that we want. This function takes the data package (<code>pkg</code>), the name of the sysmeta field to query (in this case we use the <code>fileName</code>), and the value that you want to match that field to (in this case, ‘PWS_Weir_Tower_export.csv’).</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="building-provenance.html#cb103-1" aria-hidden="true" tabindex="-1"></a>sourceObjId <span class="ot">&lt;-</span> <span class="fu">selectMember</span>(dp, <span class="at">name=</span><span class="st">&quot;sysmeta@fileName&quot;</span>, <span class="at">value=</span><span class="st">&#39;PWS_Weir_Tower_export.csv&#39;</span>)</span></code></pre></div>
<p>This returns a list of the source object <code>PID</code>s that match the query (in this case only one object matches).</p>
<pre><code>&gt; sourceObjId
[1] &quot;knb.92051.1&quot;</code></pre>
<p>Now we need to select our output object. Here, we use the <code>selectMember()</code> function again, and save the result to a new variable.</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="building-provenance.html#cb105-1" aria-hidden="true" tabindex="-1"></a>outputObjId <span class="ot">&lt;-</span> <span class="fu">selectMember</span>(dp, <span class="at">name=</span><span class="st">&quot;sysmeta@fileName&quot;</span>, <span class="at">value=</span><span class="st">&#39;PWS_weirTower.csv&#39;</span>)</span></code></pre></div>
<p>Now we query for the R script. In this case, we query based on the value of the <code>formatId</code> as opposed to the <code>fileName</code>. This can be useful if you wish to select a large list of <code>PID</code>s that are all similar.</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="building-provenance.html#cb106-1" aria-hidden="true" tabindex="-1"></a>programObjId <span class="ot">&lt;-</span> <span class="fu">selectMember</span>(dp, <span class="at">name=</span><span class="st">&quot;sysmeta@formatId&quot;</span>, <span class="at">value=</span><span class="st">&quot;application/R&quot;</span>)</span></code></pre></div>
<p>Next, you use these lists of <code>PID</code>s and a function called <code>describeWorkflow()</code> to add these relationships to the data package. Note that if you do not have a program in the workflow, or a source file, you can simply leave those arguments blank.</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="building-provenance.html#cb107-1" aria-hidden="true" tabindex="-1"></a>dp <span class="ot">&lt;-</span> <span class="fu">describeWorkflow</span>(dp, <span class="at">sources=</span>sourceObjId, <span class="at">program=</span>programObjId, <span class="at">derivations=</span>outputObjId)</span></code></pre></div>
<p>Viewing <code>pkg</code> again confirms that these relationships have been inserted into the data package, as shown by the <code>wasDerivedFrom</code> and <code>wasGeneratedBy</code> statements. It is always a good idea to print <code>pkg</code> to confirm that your <code>PID</code> selection process worked as expected, and your prov relationships make sense.</p>
<pre><code>Relationships (updated):

                                subject                 predicate                               object
15 _1db49d06-ae98-4...9101-39f7c0b45a95                  rdf:type                     prov:Association
14 _1db49d06-ae98-4...9101-39f7c0b45a95              prov:hadPlan      esc_reformatting_PWSweirTower.R
1       esc_reformatting_PWSweirTower.R       cito:isDocumentedBy urn:uuid:8f50160...b22d-050a4176a97b
16      esc_reformatting_PWSweirTower.R                  rdf:type                      provone:Program
8                     PWS_weirTower.csv       cito:isDocumentedBy urn:uuid:8f50160...b22d-050a4176a97b
11                    PWS_weirTower.csv                  rdf:type                         provone:Data
20                    PWS_weirTower.csv       prov:wasDerivedFrom            PWS_Weir_Tower_export.csv
19                    PWS_weirTower.csv       prov:wasGeneratedBy urn:uuid:3dd59b0...bc38-3b5d8fa644ac
6             PWS_Weir_Tower_export.csv       cito:isDocumentedBy urn:uuid:8f50160...b22d-050a4176a97b
10            PWS_Weir_Tower_export.csv                  rdf:type                         provone:Data
9                 _r1515544826r415842r1                 foaf:name                     DataONE R Client
17 urn:uuid:3dd59b0...bc38-3b5d8fa644ac        dcterms:identifier urn:uuid:3dd59b0...bc38-3b5d8fa644ac
13 urn:uuid:3dd59b0...bc38-3b5d8fa644ac                  rdf:type                    provone:Execution
12 urn:uuid:3dd59b0...bc38-3b5d8fa644ac prov:qualifiedAssociation _1db49d06-ae98-4...9101-39f7c0b45a95
18 urn:uuid:3dd59b0...bc38-3b5d8fa644ac                 prov:used            PWS_Weir_Tower_export.csv
5  urn:uuid:8f50160...b22d-050a4176a97b            cito:documents      esc_reformatting_PWSweirTower.R
4  urn:uuid:8f50160...b22d-050a4176a97b            cito:documents                    PWS_weirTower.csv
3  urn:uuid:8f50160...b22d-050a4176a97b            cito:documents            PWS_Weir_Tower_export.csv
2  urn:uuid:8f50160...b22d-050a4176a97b            cito:documents urn:uuid:8f50160...b22d-050a4176a97b
7  urn:uuid:8f50160...b22d-050a4176a97b       cito:isDocumentedBy urn:uuid:8f50160...b22d-050a4176a97b</code></pre>
<p>Finally, you can upload the data package using the <code>uploadDataPackage()</code> function, which takes the DataONE client <code>d1c</code> we set in the beginning, the updated <code>pkg</code> variable, some options for public read, and whether or not informational messages are printed during the upload process. <strong>First, you will need to run a token obtained from <a href="https://dev.nceas.ucsb.edu/" class="uri">https://dev.nceas.ucsb.edu/</a> to publish to that node.</strong></p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="building-provenance.html#cb109-1" aria-hidden="true" tabindex="-1"></a>resmapId_new <span class="ot">&lt;-</span> <span class="fu">uploadDataPackage</span>(d1c, dp, <span class="at">public =</span> <span class="cn">TRUE</span>, <span class="at">quiet =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>If successful you should be able to navigate to the landing page of your dataset, and icons should show up where the sources and derivations are, such as in this example: <img src="images/prov_inputoutput.png" /></p>
<div id="fixing-mistakes" class="section level3 hasAnchor" number="7.3.1">
<h3><span class="header-section-number">7.3.1</span> Fixing mistakes<a href="building-provenance.html#fixing-mistakes" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>If you messed up updating a data package using <code>datapack</code>, there unfortunately isn’t a great way to undo your work, as the <code>describeWorkflow()</code> only adds prov relationships, it does not replace them. If you messed up, the best course of action is to update the resource map with a clean version that does not have prov using <code>update_resource_map()</code>, and then go through the steps outlined above again.</p>
<p>Note: this has not been thoroughly tested, and more extreme actions may be necessary to fully nuke the prov relationships. Consult Peter or Jeanette if things do not work as expected.</p>
</div>
</div>
<div id="references" class="section level2 hasAnchor" number="7.4">
<h2><span class="header-section-number">7.4</span> References<a href="building-provenance.html#references" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Ioannidis, John P A. 2005. “Why Most Published Research Findings Are False.” PLoS Medicine 2 (8): e124. <a href="https://doi.org/10.1371/journal.pmed.0020124" class="uri">https://doi.org/10.1371/journal.pmed.0020124</a>.</p>
<p>Hampton, Stephanie E, Sean Anderson, Sarah C Bagby, Corinna Gries, Xueying Han, Edmund Hart, Matthew B Jones, et al. 2015. “The Tao of Open Science for Ecology.” Ecosphere 6 (July). <a href="https://doi.org/10.1890/ES14-00402.1" class="uri">https://doi.org/10.1890/ES14-00402.1</a>.</p>
<p>Munafò, Marcus R., Brian A. Nosek, Dorothy V. M. Bishop, Katherine S. Button, Christopher D. Chambers, Nathalie Percie du Sert, Uri Simonsohn, Eric-Jan Wagenmakers, Jennifer J. Ware, and John P. A. Ioannidis. 2017. “A Manifesto for Reproducible Science.” Nature Human Behaviour 1 (1): 0021. <a href="https://doi.org/10.1038/s41562-016-0021" class="uri">https://doi.org/10.1038/s41562-016-0021</a>.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="editing-system-metadata.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="using-git.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
